<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Commtest</title>
		<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
		<meta name="viewport" content="width=device-width">
		<link href="../css/styles.css" rel="stylesheet" type="text/css">
		<script src="../../js/CRUtil.js"></script>
		<script src="../../js/CRConfig.js"></script>
		<script src="../../js/CREvent.js"></script>
		<script src="../../js/CRStateMachine.js"></script>
		<script src="../../js/CREventSender.js"></script>
		<script src="../../js/CREventReceiver.js"></script>
		<script src="../../js/CRSocket.js"></script>
		<script src="../js/CommTestClient.js"></script>
	</head>
	<body onload="config = new CRConfig('commtest'); client = new CommTestClient(config, 'responder'); client.init()">
		<h1>CommTest <span id="roleHeaderSpan"></span> <span id="versionHeaderSpan"></span></h1>
		<table class="group">
			<tr>
				<td class="group">
					<table class="group">
						<tr>
							<td class="group">
								<table class="info">
									<tr>
										<th class="info top" colspan="2">
											<a href="https://neurolab.no/docs/crsocket/resources/eventsource.html#eventOutReq">ServerIn</a>
										</th>
									</tr>
									<tr><th class="info count">open</th><td class="info count" id="noOfOpenEventsCell"></td></tr>
									<tr><th class="info count">error</th><td class="info count" id="noOfErrorEventsCell"></td></tr>
									<tr><th class="info count">hello</th><td class="info count" id="noOfHelloEventsCell"></td></tr>
									<tr><th class="info count">alive</th><td class="info count" id="noOfIncomingAliveEventsCell"></td></tr>
									<tr><th class="info count">closed</th><td class="info count" id="noOfClosedEventsCell"></td></tr>
									<tr><th class="info count">aborted</th><td class="info count" id="noOfAbortedEventsCell"></td></tr>
									<tr><th class="info count">shutdown</th><td class="info count" id="noOfShutdownEventsCell"></td></tr>
								</table>
							</td>
							<td class="group">
								<table class="info">
									<tr>
										<th class="info top" colspan="2">
											<a href="https://neurolab.no/docs/crsocket/resources/eventsource.html#eventInReq">ServerOut</a>
										</th>
									</tr>
									<tr><th class="info count">alive</th><td class="info count" id="noOfOutgoingAliveEventsCell"></td></tr>
									<tr><th class="info count">close</th><td class="info count" id="noOfCloseEventsCell"></td></tr>
								</table>
								<table class="info">
									<tr><th class="info top" colspan="2">Timing</th></tr>
									<tr><th class="info millisecs">conn</th><td class="info millisecs" id="connectDtCell"></td></tr>
									<tr><th class="info millisecs">open</th><td class="info millisecs" id="openDtCell"></td></tr>
									<tr><th class="info millisecs">closed</th><td class="info millisecs" id="closedDtCell"></td></tr>
									<tr><th class="info millisecs">alive</th><td class="info millisecs" id="aliveDtCell"></td></tr>
								</table>
							</td>
						</tr>
					</table>
					<table class="info">
						<tr><th class="info top" colspan="2">Parameters</th></tr>
						<tr><th class="info param">clientId</th><td class="info param" id="clientIdCell"></td></tr>
						<tr><th class="info param">accessToken</th><td class="info param" id="accessTokenCell"></td></tr>
						<tr><th class="info param">partnerClientId</th><td class="info param" id="partnerClientIdCell"></td></tr>
					</table>
				</td>
				<td class="group">
					<table class="group">
						<tr>
							<td class="group">
								<table class="info">
									<tr>
										<th class="info top" colspan="2">
											<a href="https://neurolab.no/docs/crsocket/General/protocol.html#commManagement">PartnerIn</a>
										</th>
									</tr>
									<tr><th class="info count">ping</th><td class="info count" id="noOfIncomingPingEventsCell"></td></tr>
									<tr><th class="info count">inactive</th><td class="info count" id="noOfIncomingInactiveEventsCell"></td></tr>
									<tr><th class="info count">unassign</th><td class="info count" id="noOfIncomingUnassignEventsCell"></td></tr>
									<tr><th class="info count">reject</th><td class="info count" id="noOfIncomingRejectEventsCell"></td></tr>
								</table>
							</td>
							<td class="group">
								<table class="info right">
									<tr>
										<th class="info top" colspan="2">
											<a href="https://neurolab.no/docs/crsocket/General/protocol.html#commManagement">PartnerOut</a>
										</th>
									</tr>
									<tr><th class="info count">ping</th><td class="info count" id="noOfOutgoingPingEventsCell"></td></tr>
									<tr><th class="info count">inactive</th><td class="info count" id="noOfOutgoingInactiveEventsCell"></td></tr>
									<tr><th class="info count">unassign</th><td class="info count" id="noOfOutgoingUnassignEventsCell"></td></tr>
									<tr><th class="info count">reject</th><td class="info count" id="noOfOutgoingRejectEventsCell"></td></tr>
								</table>
							</td>
						</tr>
					</table>
					<table class="info right">
						<tr><th class="info top" colspan="2">States</th></tr>
						<tr><th class="info state">socketState</th><td class="info state" id="socketStateCell"></td></tr>
						<tr><th class="info state">socketSubState</th><td class="info state" id="socketSubStateCell"></td></tr>
						<tr><th class="info state">receiverState</th><td class="info state" id="eventReceiverStateCell"></td></tr>
						<tr><th class="info state">receiverSubState</th><td class="info state" id="eventReceiverSubStateCell"></td></tr>
						<tr><th class="info state">senderState</th><td class="info state" id="eventSenderStateCell"></td></tr>
						<tr><th class="info state">senderSubState</th><td class="info state" id="eventSenderSubStateCell"></td></tr>
					</table>
				</td>
			</tr>
		</table>
		<table class="setup right">
			<tr>
				<th class="setup">Console Logging</th>
				<td class="setup">
					<button class="setup" id="logStatesButton" title="Log all state changes" onclick="client.flipLogStates()">States</button>
				</td>
				<td class="setup">
					<button class="setup" id="logEventsButton" title="Log all events" onclick="client.flipLogEvents()">Events</button>
				</td>
			</tr>
		</table>
		<hr>
		<table class="setup right">
			<tr>
				<th class="setup" id="activeHeader">Active</th>
				<td class="setup">
					<input class="setup" id="clientIdInput" type="text" title="The current clientId (automatically assigned)" placeholder="clientId" readonly>
				</td>
				<td class="setup">
					<button class="setup" id="resumeButton" title="Reactivate the CRSocket" type="button" onclick="client.resumeApp()">Resume</button>
				</td>
				<td class="setup">
					<button class="setup" id="pauseButton" title="Deactivate the CRSocket" type="button" onclick="client.pauseApp()">Pause</button>
				</td>
				<td class="setup">
					<button class="setup" id="clearClientIdButton" title="Clear the current clientId" type="button" onclick="client.clearClientId()">Clear</button>
				</td>
			</tr>
			<tr>
				<th class="setup" id="authHeader">Auth</th>
				<td class="setup">
					<input class="setup" id="accessTokenInput" title="The current accessToken" type="text" placeholder="Token">
				</td>
				<td class="setup">
					<button class="setup" id="signInButton" title="Sign in to the eventreciever" type="button" onclick="client.assignAccessToken()">SignIn</button>
				</td>
				<td class="setup">
					<button class="setup" id="signOutButton" title="Sign out from the eventreciever" type="button" onclick="client.unassignAccessToken()">SignOut</button>
				</td>
				<td class="setup">
					<button class="setup" id="clearAccessTokenButton" title="Clear the current accessToken" type="button" onclick="client.clearAccessToken()">Clear</button>
				</td>
			</tr>
			<tr>
				<th class="setup" id="pairedHeader">Paired</th>
				<td class="setup">
					<input class="setup" id="partnerClientIdInput" title="The current partnerClientId" type="text" placeholder="ClientId">
				</td>
				<td class="setup">
					<button class="setup" id="assignPartnerClientIdButton" title="Assign the partnerClientId to the CRSocket" type="button" onclick="client.assignPartner()">Assign</button>
				</td>
				<td class="setup">
					<button class="setup" id="unassignPartnerClientIdButton" title="Unassign the partnerClientId from the CRSocket" type="button" onclick="client.unassignPartner()">Unassign</button>
				</td>
				<td class="setup">
					<button class="setup" id="clearPartnerClientIdButton" title="Clear the current partnerClientId" type="button" onclick="client.clearPartner()">Clear</button>
				</td>
			</tr>
		</table>
		<hr>
		<table class="setup bottom right">
			<tr>
				<th class="setup" rowspan="2">Send events to the currently assigned partner</th>
				<td class="setup">
					<input class="setup" id="eventOutTypeInput" title="Event type" type="text" placeholder="type" required>
				</td>
				<td class="setup">
					<input class="setup optional" id="eventOutSubTypeInput" title="Event subType" type="text" placeholder="subType"></td>
				<td class="setup evParam"><input class="setup evParam optional" id="eventOutParam1Input" title="Event param 1" type="text" placeholder="param1">
				</td>
				<td class="setup evParam">
					<input class="setup evParam optional" id="eventOutParam2Input" title="Event param 2" type="text" placeholder="param2">
				</td>
				<td class="setup evOption">
					<button class="setup evOption" id="eventOutLogButton" title="The CREvent log attribute" onclick="client.flipFlagged(this.id)">Log</button>
				</td>
				<td class="setup evOption">
					<button class="setup evOption" id="eventOutBufButton" onclick="client.flipFlagged(this.id)">Buf</button>
				</td>
				<td class="setup evOption">
					<button class="setup evOption" id="eventOutItcButton" onclick="client.flipFlagged(this.id)">Itc</button>
				</td>
			</tr>
			<tr>
				<td class="setup"><input class="setup" id="eventOutCountInput" type="number" placeholder="count" required></td>
				<td class="filler"></td>
				<td class="setup evDt"><input class="setup evDt" id="eventOutMinDtInput" type="number" placeholder="minDt" required></td>
				<td class="setup evDt"><input class="setup evDt" id="eventOutMaxDtInput" type="number" placeholder="maxDt" required></td>
				<td class="filler" colspan="3"><button class="setup" id="eventOutSendButton" type="button" onclick="client.sendEventSeq()">Send</button></td>
			</tr>
			<tr>
				<th class="setup">Events received from the current partner</th>
				<td class="setup"><input class="setup optional" id="eventInTypeInput" type="text" placeholder="type" readonly></td>
				<td class="setup"><input class="setup optional" id="eventInSubTypeInput" type="text" placeholder="subType" readonly></td>
				<td class="setup evParam"><input class="setup evParam optional" id="eventInParam1Input" type="text" placeholder="param1" readonly></td>
				<td class="setup evParam"><input class="setup evParam optional" id="eventInParam2Input" type="text" placeholder="param2" readonly></td>
				<td class="setup evOption"><button class="setup evOption" id="eventInLogButton" disabled>Log</button></td>
				<td class="setup evOption"><button class="setup evOption" id="eventInBufButton" disabled>Buf</button></td>
				<td class="setup evOption"><button class="setup evOption" id="eventInItcButton" disabled>Itc</button></td>
			</tr>
		</table>
	</body>
</html>
